

Requête N°1

SELECT Potion.Nom_Potion, Onguent.Nom_Onguent, Ingredient.Nom_Ingredient
FROM ((((Potion INNER JOIN Se_compose ON Potion.ID_Potion = Se_compose.ID_Potion)
INNER JOIN Ingredient ON Se_compose.ID_Ingredient =Ingredient.ID_Ingredient)
INNER JOIN est_compose ON Ingredient.ID_Ingredient = est_compose.ID_Ingredient)
INNER JOIN Onguent ON est_compose.ID_Onguent = Onguent.ID_Onguent)
Where Ingredient.Nom_Ingredient = 'chenilles'
AND Valide_Potion = 'Valide';



Requête N°2

SELECT Potion.Nom_Potion, Onguent.Nom_Onguent, Ingredient.Nom_Ingredient
FROM ((((Potion INNER JOIN Se_compose ON Potion.ID_Potion = Se_compose.ID_Potion)
INNER JOIN Ingredient ON Se_compose.ID_Ingredient =Ingredient.ID_Ingredient)
INNER JOIN est_compose ON Ingredient.ID_Ingredient = est_compose.ID_Ingredient)
INNER JOIN Onguent ON est_compose.ID_Onguent = Onguent.ID_Onguent)
WHERE Valide_Potion = 'Valide'
AND Se_compose.ID_Ingredient IN (
SELECT ID_Ingredient
FROM est_compose )
GROUP BY Ingredient.Nom_Ingredient;


Requête N°3

SELECT Diluant.Nom_Diluant, Potion.Nom_Potion
FROM (Diluant INNER JOIN Potion ON Potion.ID_Diluant = Diluant.ID_Diluant)
WHERE Valide_Potion = 'Valide'
ORDER BY Diluant.Nom_Diluant;



Requete N°4

SELECT Potion.Nom_Potion, Potion.Temperature
FROM Potion
WHERE Valide_Potion = 'Valide'
ORDER BY Potion.Temperature;




Requette N°5

SELECT Potion.Nom_Potion, Potion.Prix_Potion, 
SUM((Ingredient.Prix_Ingredient * Se_compose.Quantite_Ingredient) + Diluant.Prix_Diluant) AS Prix_ingredient_et_diluant
FROM (((Diluant INNER JOIN Potion ON Diluant.ID_Diluant = Potion.ID_Diluant)
INNER JOIN Se_compose ON Potion.ID_Potion = Se_compose.ID_Potion)
INNER JOIN Ingredient ON Se_compose.ID_Ingredient =Ingredient.ID_Ingredient)
GROUP BY Potion.Nom_Potion;









DELIMITER |
 CREATE PROCEDURE AjoutRecette (IN IDPersonne INT, IN NomPotion VARCHAR(255),
 IN Ingredient1 VARCHAR(255) ,IN QuantiteIngredient1 INT(11),
  IN Ingredient2 VARCHAR(255),IN QuantiteIngredient2 INT(11),
  IN Ingredient3 VARCHAR(255),IN QuantiteIngredient3 INT(11),
 IN Ingredient4 VARCHAR(255),IN QuantiteIngredient4 INT(11),
 IN Ingredient5 VARCHAR(255),IN QuantiteIngredient5 INT(11),
 IN PrixPotion DECIMAL (15,3),IN NomDiluant VARCHAR(255),IN Temperatur INT(255))

 BEGIN


 INSERT INTO Potion (`ID_Personne`,`Nom_Potion`,`Prix_potion`,`Temperature`, `Valider_Potion`) VALUES
 (IDPersonne, NomPotion, PrixPotion, Temperatur, 'Attente');


 UPDATE Potion
 SET `ID_Diluant` = (SELECT ID_Diluant
 	FROM Diluant
 	WHERE Nom_Diluant = NomDiluant)
 where ID_Potion = LAST_INSERT_ID();


INSERT INTO Se_compose (ID_Potion, ID_Ingredient, Quantite_Ingredient)
SELECT ID_Potion, '1', '1'
FROM Potion
ORDER BY ID_Potion DESC LIMIT 1;


 UPDATE Se_compose SET
 ID_Ingredient = (SELECT ID_Ingredient
 	FROM Ingredient
 	WHERE Nom_Ingredient = Ingredient1),
  Quantite_Ingredient = QuantiteIngredient1
  ORDER BY ID_Potion DESC LIMIT 1;

  DELETE FROM `Se_compose`
  WHERE ID_Ingredient = NULL;

 INSERT INTO Se_compose (ID_Potion,ID_Ingredient,Quantite_Ingredient)
SELECT ID_Potion, '2', '1'
FROM Potion
ORDER BY ID_Potion DESC LIMIT 1;

 UPDATE Se_compose SET
 ID_Ingredient = (SELECT ID_Ingredient
 	FROM Ingredient
 	WHERE Nom_Ingredient = Ingredient2),
  Quantite_Ingredient = QuantiteIngredient2
  ORDER BY ID_Potion DESC LIMIT 1;

  DELETE FROM `Se_compose`
  WHERE ID_Ingredient = NULL;



 INSERT INTO Se_compose (ID_Potion,ID_Ingredient,Quantite_Ingredient)
SELECT ID_Potion, '3', '1'
FROM Potion
ORDER BY ID_Potion DESC LIMIT 1;

 UPDATE Se_compose SET
 ID_Ingredient = (SELECT ID_Ingredient
 	FROM Ingredient
 	WHERE Nom_Ingredient = Ingredient3),
  Quantite_Ingredient = QuantiteIngredient3
  ORDER BY ID_Potion DESC LIMIT 1;

  DELETE FROM `Se_compose`
  WHERE ID_Ingredient = NULL;




 INSERT INTO Se_compose (ID_Potion,ID_Ingredient, Quantite_Ingredient)
SELECT ID_Potion, '4', '1'
FROM Potion
ORDER BY ID_Potion DESC LIMIT 1;

 UPDATE Se_compose SET
 ID_Ingredient = (SELECT ID_Ingredient
 	FROM Ingredient
 	WHERE Nom_Ingredient = Ingredient4),
  Quantite_Ingredient = QuantiteIngredient4
  ORDER BY ID_Potion DESC LIMIT 1;

  DELETE FROM `Se_compose`
  WHERE ID_Ingredient = NULL;



 INSERT INTO Se_compose (ID_Potion,ID_Ingredient,Quantite_Ingredient)
SELECT ID_Potion, '5', '1'
FROM Potion
ORDER BY ID_Potion DESC LIMIT 1;

 UPDATE Se_compose SET
 ID_Ingredient = (SELECT ID_Ingredient
 	FROM Ingredient
 	WHERE Nom_Ingredient = Ingredient5),
  Quantite_Ingredient = QuantiteIngredient5
  ORDER BY ID_Potion DESC LIMIT 1;


  DELETE FROM `Se_compose`
  WHERE ID_Ingredient = NULL;


  DELETE FROM `Potion`
  WHERE ID_Diluant = NULL;


 END |
 DELIMITER ;
