

Requête N°1

SELECT Potion.Nom_Potion, Onguent.Nom_Onguent, Ingredient.Nom_Ingredient
FROM ((((Potion INNER JOIN Se_compose ON Potion.ID_Potion = Se_compose.ID_Potion)
INNER JOIN Ingredient ON Se_compose.ID_Ingredient =Ingredient.ID_Ingredient)
INNER JOIN est_compose ON Ingredient.ID_Ingredient = est_compose.ID_Ingredient)
INNER JOIN Onguent ON est_compose.ID_Onguent = Onguent.ID_Onguent)
Where Ingredient.Nom_Ingredient = 'chenilles'
AND Valider_Potion = 'Valider';



Requête N°2

SELECT Potion.Nom_Potion, Onguent.Nom_Onguent, Ingredient.Nom_Ingredient
FROM ((((Potion INNER JOIN Se_compose ON Potion.ID_Potion = Se_compose.ID_Potion)
INNER JOIN Ingredient ON Se_compose.ID_Ingredient =Ingredient.ID_Ingredient)
INNER JOIN est_compose ON Ingredient.ID_Ingredient = est_compose.ID_Ingredient)
INNER JOIN Onguent ON est_compose.ID_Onguent = Onguent.ID_Onguent)
WHERE Valider_Potion = 'Valider'
AND Se_compose.ID_Ingredient IN (
SELECT ID_Ingredient
FROM est_compose )
GROUP BY Ingredient.Nom_Ingredient;


Requête N°3

SELECT Diluant.Nom_Diluant, Potion.Nom_Potion
FROM (Diluant INNER JOIN Potion ON Potion.ID_Diluant = Diluant.ID_Diluant)
WHERE Valider_Potion = 'Valider'
ORDER BY Diluant.Nom_Diluant;



Requete N°4

SELECT Potion.Nom_Potion, Potion.Temperature
FROM Potion
WHERE Valider_Potion = 'Valider'
ORDER BY Potion.Temperature;



Requette N°5

SELECT Potion.Nom_Potion, Potion.Prix_Potion, 
SUM((Ingredient.Prix_Ingredient * Se_compose.Quantite_Ingredient) + Diluant.Prix_Diluant) AS Prix_ingredient_et_diluant
FROM (((Diluant INNER JOIN Potion ON Diluant.ID_Diluant = Potion.ID_Diluant)
INNER JOIN Se_compose ON Potion.ID_Potion = Se_compose.ID_Potion)
INNER JOIN Ingredient ON Se_compose.ID_Ingredient =Ingredient.ID_Ingredient)
GROUP BY Potion.Nom_Potion;




Requette d ajout de potion : il faut bien mettre NULL au nom de la potion si il n y en a pas   

CALL AjoutRecette(1,'final','epines de poro',4,'oeuf de dragon',3,'ecaille de dragon',10,'NULL',0,'NULL',0,5000.000,'Eau',30);






DELIMITER |

CREATE PROCEDURE AjoutRecette (IN IDPersonne INT, IN NomPotion VARCHAR(255),
IN Ingredient1 VARCHAR(255) ,IN QuantiteIngredient1 INT(11),
IN Ingredient2 VARCHAR(255),IN QuantiteIngredient2 INT(11),
IN Ingredient3 VARCHAR(255),IN QuantiteIngredient3 INT(11),
IN Ingredient4 VARCHAR(255),IN QuantiteIngredient4 INT(11),
IN Ingredient5 VARCHAR(255),IN QuantiteIngredient5 INT(11),
IN PrixPotion DECIMAL (15,3),IN NomDiluant VARCHAR(255),IN Temperatur INT(255))


 BEGIN

 INSERT INTO Potion (`Nom_Potion`,`Prix_Potion`, `Temperature`, `Valider_Potion`,`ID_Personne`,`ID_Diluant`)
 VALUES  ( NomPotion, PrixPotion, Temperatur, 'Attente',IDPersonne,(SELECT ID_Diluant FROM Diluant WHERE Nom_Diluant = NomDiluant));

 SET @idpotion = (SELECT ID_Potion FROM Potion ORDER BY ID_Potion DESC LIMIT 1);
 SET @iding1 = (SELECT ID_Ingredient FROM Ingredient WHERE Nom_Ingredient = Ingredient1);
 SET @iding2 = (SELECT ID_Ingredient FROM Ingredient WHERE Nom_Ingredient = Ingredient2);
 SET @iding3 = (SELECT ID_Ingredient FROM Ingredient WHERE Nom_Ingredient = Ingredient3);
 SET @iding4 = (SELECT ID_Ingredient FROM Ingredient WHERE Nom_Ingredient = Ingredient4);
 SET @iding5 = (SELECT ID_Ingredient FROM Ingredient WHERE Nom_Ingredient = Ingredient5);

INSERT INTO Se_compose (`Quantite_Ingredient`, `ID_Potion`, `ID_Ingredient`)
VALUES ( QuantiteIngredient1, @idpotion, @iding1);

DELETE FROM `Se_compose`
WHERE ID_Ingredient = 22;


INSERT INTO Se_compose (`Quantite_Ingredient`, `ID_Potion`, `ID_Ingredient`)
VALUES ( QuantiteIngredient2, @idpotion, @iding2);

DELETE FROM `Se_compose`
WHERE ID_Ingredient = 22;


INSERT INTO Se_compose (`Quantite_Ingredient`, `ID_Potion`, `ID_Ingredient`)
VALUES ( QuantiteIngredient3, @idpotion, @iding3);

DELETE FROM `Se_compose`
WHERE ID_Ingredient = 22;


INSERT INTO Se_compose (`Quantite_Ingredient`, `ID_Potion`, `ID_Ingredient`)
VALUES ( QuantiteIngredient4, @idpotion, @iding4);

DELETE FROM `Se_compose`
WHERE ID_Ingredient = 22;


INSERT INTO Se_compose (`Quantite_Ingredient`, `ID_Potion`, `ID_Ingredient`)
VALUES ( QuantiteIngredient5, @idpotion, @iding5);

DELETE FROM `Se_compose`
WHERE ID_Ingredient = 22;

 END |
 DELIMITER ;
 
 Requête 6 : SELECT AVG (Quantite_ingredient) AS Moyenne_Ingredient,Potion.Nom_potion
FROM Potion INNER JOIN se_compose ON se_compose.ID_Potion= Potion.ID_Potion
GROUP BY Potion.Nom_potion;
